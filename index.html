<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Le portail vers Harmonia. Créez, partagez, connectez-vous." />
  <title>Portail d'Accès — Harmonia</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/gotrue-js/dist/gotrue.min.js" defer></script>

  <style>
    /* --- VARIABLES & RESET --- */
    :root {
      --bg1: #0f1726;
      --bg2: #07102b;
      --accent1: #ff4d6d;
      --accent2: #7c5cff;
      --text-light: #e6eef8;
      --text-muted: #9aa3b2;
      --border-color: rgba(255, 255, 255, 0.05);
      --success: #50ffaa;
      --error: #ff5050;
    }

    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      scroll-behavior: smooth;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      color: var(--text-light);
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      line-height: 1.6;
    }

    /* --- LAYOUT --- */
    .container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .wrap {
      width: 100%;
      max-width: 980px;
      display: grid;
      grid-template-columns: 1fr 420px;
      gap: 2.5rem;
      align-items: center;
    }

    /* --- HERO SECTION --- */
    .hero {
      padding: 2rem;
      border-radius: 1.25rem;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      border: 1px solid var(--border-color);
    }
    .logo { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.5rem; }
    .badge { width: 56px; height: 56px; border-radius: 0.75rem; background: linear-gradient(135deg, var(--accent1), var(--accent2)); display: grid; place-content: center; font-weight: 700; font-size: 1.5rem; color: #fff; }
    .logo-title { font-weight: 700; font-size: 1.1rem; }
    .logo-subtitle { font-size: 0.8rem; color: var(--text-muted); }
    .hero h1 { margin: 0; font-size: 1.8rem; line-height: 1.2; font-weight: 600; }
    .hero p { color: var(--text-muted); margin-top: 1rem; font-size: 0.95rem; max-width: 560px; }
    .features { display: flex; flex-wrap: wrap; gap: 0.75rem; margin-top: 1.5rem; }
    .feature { background: rgba(255,255,255,0.03); padding: 0.6rem 0.9rem; border-radius: 0.6rem; font-size: 0.8rem; color: #dfe8ff; }

    /* --- CARD & FORMS --- */
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius: 1rem;
      padding: 2rem;
      border: 1px solid var(--border-color);
      box-shadow: 0 14px 40px rgba(2,6,23,0.6);
    }
    
    .form-section {
        margin-bottom: 2.5rem;
    }
    .form-section:last-child {
        margin-bottom: 0;
    }

    .form-title {
        font-size: 1.5rem;
        font-weight: 600;
        text-align: center;
        margin-bottom: 1.5rem;
    }

    .card-divider {
        border: none;
        height: 1px;
        background-color: var(--border-color);
        margin: 2.5rem 0;
    }
    
    form { margin-top: 0.5rem; }
    .field { margin-bottom: 1rem; text-align: left; }
    label { display: block; font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.4rem; }
    input {
      width: 100%;
      padding: 0.8rem 1rem;
      border-radius: 0.6rem;
      border: 1px solid var(--border-color);
      background: rgba(0,0,0,0.25);
      color: var(--text-light);
      outline: none;
      font-size: 0.9rem;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    input:focus-visible { border-color: var(--accent2); box-shadow: 0 0 0 3px rgba(124, 92, 255, 0.3); }
    input[type="date"]::-webkit-calendar-picker-indicator { cursor: pointer; filter: invert(0.7); }
    
    .btn {
      width: 100%;
      padding: 0.8rem;
      border-radius: 0.6rem;
      border: none;
      cursor: pointer;
      font-weight: 700;
      font-size: 1rem;
      background: linear-gradient(90deg, var(--accent1), var(--accent2));
      color: white;
      margin-top: 0.5rem;
      box-shadow: 0 8px 20px rgba(124, 92, 255, 0.12);
      transition: transform 0.2s, box-shadow 0.2s, opacity 0.2s;
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(124, 92, 255, 0.2); }
    .btn:disabled { cursor: not-allowed; opacity: 0.6; }
    
    .separator { text-align: center; color: var(--text-muted); font-size: 0.8rem; margin: 1.5rem 0; position: relative; }
    .separator span { background: var(--bg1); padding: 0 0.5rem; }
    .separator::before { content: ''; display: block; width: 100%; height: 1px; background: var(--border-color); position: absolute; left: 0; top: 50%; z-index: -1;}
    
    .providers { margin-top: 1rem; display: grid; gap: 0.5rem; }
    .provider-btn {
      width: 100%;
      padding: 0.7rem;
      border-radius: 0.6rem;
      cursor: pointer;
      border: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      gap: 0.7rem;
      font-weight: 600;
      font-size: 0.9rem;
      background: rgba(255, 255, 255, 0.02);
      color: var(--text-light);
      transition: background-color 0.2s;
    }
    .provider-btn:hover { background-color: rgba(255, 255, 255, 0.05); }
    .icon { width: 28px; height: 28px; border-radius: 6px; display: inline-flex; align-items: center; justify-content: center; font-weight: 700; color: #fff;}
    .g { background: #db4437; }
    .f { background: #1877f2; }
    
    .msg {
      margin-top: 1rem;
      padding: 0.8rem 1rem;
      border-radius: 0.6rem;
      font-size: 0.9rem;
      border: 1px solid transparent;
      display: none;
    }
    .msg.is-visible { display: block; }
    .msg.is-error { background: rgba(var(--error), 0.12); color: #ffbebe; border-color: rgba(var(--error), 0.1); }
    .msg.is-success { background: rgba(var(--success), 0.08); color: #c8ffdf; border-color: rgba(var(--success), 0.1); }
    
    /* --- RESPONSIVE --- */
    @media (max-width: 900px) {
      .wrap { grid-template-columns: 1fr; padding: 1rem; gap: 2rem; }
      .hero { text-align: center; }
      .hero p { max-width: 100%; }
      .features { justify-content: center; }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="wrap">
      <section class="hero">
        <div class="logo">
          <div class="badge">H</div>
          <div>
            <div class="logo-title">Harmonia</div>
            <div class="logo-subtitle">Votre espace de création et de partage.</div>
          </div>
        </div>
        <h1>Bienvenue sur Harmonia.</h1>
        <p>Explorez des communautés, forgez des alliances, vivez des expériences uniques. Ici, la connexion est réinventée.</p>
        <div class="features" role="list">
          <div class="feature" role="listitem">Communautés & Chat</div>
          <div class="feature" role="listitem">Jeux et Événements</div>
          <div class="feature" role="listitem">Partage de Médias</div>
          <div class="feature" role="listitem">Ateliers Créatifs</div>
        </div>
      </section>

      <aside class="card" aria-label="Portail d'authentification">

        <div id="signup-section" class="form-section">
          <h2 class="form-title">Créer un compte</h2>
          <form id="signup-form" autocomplete="on" novalidate>
            <div class="field"><label for="signup-firstname">Prénom</label><input id="signup-firstname" type="text" placeholder="Ton prénom" required autocomplete="given-name" /></div>
            <div class="field"><label for="signup-lastname">Nom</label><input id="signup-lastname" type="text" placeholder="Ton nom" required autocomplete="family-name" /></div>
            <div class="field"><label for="signup-dob">Date de naissance</label><input id="signup-dob" type="date" required autocomplete="bday" /></div>
            <div class="field"><label for="signup-email">Adresse e-mail</label><input id="signup-email" type="email" placeholder="explorateur@email.com" required autocomplete="email" /></div>
            <div class="field"><label for="signup-password">Mot de passe sécurisé</label><input id="signup-password" type="password" placeholder="Majuscule, minuscule, chiffre" minlength="6" required autocomplete="new-password" /></div>
            <button class="btn" type="submit">Rejoindre Harmonia</button>
            <div id="signup-msg" class="msg"></div>
          </form>
          <div class="separator"><span>ou</span></div>
          <div class="providers">
            <button type="button" class="provider-btn" data-provider="google"><span class="icon g">G</span> Continuer via Google</button>
            <button type="button" class="provider-btn" data-provider="facebook"><span class="icon f">f</span> Continuer via Facebook</button>
          </div>
        </div>

        <hr class="card-divider">

        <div id="login-section" class="form-section">
            <h2 class="form-title">Se connecter</h2>
            <form id="login-form" autocomplete="on">
              <div class="field"><label for="login-email">Adresse e-mail</label><input id="login-email" type="email" placeholder="Votre e-mail" required autocomplete="email" /></div>
              <div class="field"><label for="login-password">Mot de passe</label><input id="login-password" type="password" placeholder="Votre mot de passe" required autocomplete="current-password" /></div>
              <button class="btn" type="submit">Entrer sur Harmonia</button>
              <div id="login-msg" class="msg"></div>
            </form>
        </div>

        <hr class="card-divider">

        <div id="reset-section" class="form-section">
            <h2 class="form-title">Mot de passe oublié</h2>
            <form id="reset-form">
              <div class="field"><label for="reset-email">E-mail de récupération</label><input id="reset-email" type="email" placeholder="Votre e-mail" required autocomplete="email" /></div>
              <button class="btn" type="submit">Envoyer le lien</button>
              <div id="reset-msg" class="msg"></div>
            </form>
        </div>

      </aside>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {

      // --- CONFIGURATION ---
      const REDIRECT_URL = "home.html";
      const PASSWORD_REGEX = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/;
      const auth = new GoTrue({
        APIUrl: `${window.location.origin}/.netlify/identity`,
        setCookie: true,
      });

      // --- SÉLECTION DES ÉLÉMENTS DU DOM ---
      const dom = {
        providerBtns: document.querySelectorAll('.provider-btn'),
        forms: {
          signup: document.getElementById('signup-form'),
          login: document.getElementById('login-form'),
          reset: document.getElementById('reset-form'),
        },
        msgs: {
          signup: document.getElementById('signup-msg'),
          login: document.getElementById('login-msg'),
          reset: document.getElementById('reset-msg'),
        },
        buttons: {
          signup: document.querySelector('#signup-form .btn'),
          login: document.querySelector('#login-form .btn'),
          reset: document.querySelector('#reset-form .btn'),
        }
      };
      
      // --- FONCTIONS UTILITAIRES (INTERFACE) ---
      
      const showMsg = (el, text, type = 'is-error') => {
        el.textContent = text;
        el.className = `msg ${type} is-visible`;
      };

      const clearAllMsgs = () => {
        Object.values(dom.msgs).forEach(msgEl => {
          msgEl.className = 'msg';
        });
      };

      const setButtonsDisabled = (disabled) => {
        Object.values(dom.buttons).forEach(button => {
          button.disabled = disabled;
        });
      };

      // --- LOGIQUE D'AUTHENTIFICATION ---

      const handleOAuth = (provider) => {
        window.location.href = `/.netlify/identity/authorize?provider=${provider}`;
      };

      const handleSignup = async (e) => {
        e.preventDefault();
        clearAllMsgs();
        setButtonsDisabled(true);

        const form = dom.forms.signup;
        const firstname = form.querySelector('#signup-firstname').value.trim();
        const lastname = form.querySelector('#signup-lastname').value.trim();
        const dob = form.querySelector('#signup-dob').value;
        const email = form.querySelector('#signup-email').value.trim();
        const password = form.querySelector('#signup-password').value;

        if (!firstname || !lastname || !dob || !email || !password) {
            showMsg(dom.msgs.signup, 'Tous les champs sont obligatoires.');
            setButtonsDisabled(false);
            return;
        }
        if (password.length < 6) {
            showMsg(dom.msgs.signup, 'Le mot de passe doit faire au moins 6 caractères.');
            setButtonsDisabled(false);
            return;
        }
        if (!PASSWORD_REGEX.test(password)) {
            showMsg(dom.msgs.signup, 'Le mot de passe doit contenir une majuscule, une minuscule et un chiffre.');
            setButtonsDisabled(false);
            return;
        }

        const userMetadata = { data: { first_name: firstname, last_name: lastname, date_of_birth: dob } };

        try {
          await auth.signup(email, password, userMetadata);
          showMsg(dom.msgs.signup, 'Compte créé ! Vérifiez votre boîte mail pour confirmer votre accès.', 'is-success');
        } catch (err) {
          console.error('Erreur inscription:', err);
          showMsg(dom.msgs.signup, err.message || 'Une erreur est survenue.');
        } finally {
          setButtonsDisabled(false);
        }
      };

      const handleLogin = async (e) => {
        e.preventDefault();
        clearAllMsgs();
        setButtonsDisabled(true);

        const email = dom.forms.login.querySelector('#login-email').value.trim();
        const password = dom.forms.login.querySelector('#login-password').value;

        try {
          await auth.login(email, password, true);
          window.location.href = REDIRECT_URL;
        } catch (err) {
          console.error('Erreur connexion:', err);
          showMsg(dom.msgs.login, 'Email ou mot de passe incorrect.');
          setButtonsDisabled(false);
        }
      };

      const handleReset = async (e) => {
        e.preventDefault();
        clearAllMsgs();
        setButtonsDisabled(true);
        
        const email = dom.forms.reset.querySelector('#reset-email').value.trim();

        try {
          await auth.requestPasswordRecovery(email);
        } catch (err) {
          console.error('Erreur de récupération (ignorée pour la sécurité):', err);
        } finally {
          showMsg(dom.msgs.reset, "Si un compte avec cet e-mail existe, un lien de récupération a été envoyé.", 'is-success');
          setButtonsDisabled(false);
        }
      };
      
      // --- ÉCOUTEURS D'ÉVÉNEMENTS ---
      dom.providerBtns.forEach(btn => btn.addEventListener('click', () => handleOAuth(btn.dataset.provider)));
      
      dom.forms.signup.addEventListener('submit', handleSignup);
      dom.forms.login.addEventListener('submit', handleLogin);
      dom.forms.reset.addEventListener('submit', handleReset);
      
      // --- VÉRIFICATION INITIALE ---
      if (auth.currentUser()) {
        window.location.href = REDIRECT_URL;
      }
    });
  </script>
</body>
                </html>
                
