<!DOCTYPE html>  
<html lang="fr">  
<head>  
  <meta charset="UTF-8" />  
  <meta name="viewport" content="width=device-width,initial-scale=1" />  
  <meta name="description" content="Le portail vers Harmonia. Créez, partagez, connectez-vous." />  
  <title>Portail d'Accès — Harmonia</title>  

  <link rel="preconnect" href="https://fonts.googleapis.com">  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">  

  <!-- gotrue -->  
  <script src="https://unpkg.com/gotrue-js/dist/gotrue.min.js" defer></script>  

  <style>  
    /* ton CSS reste identique */  
  </style>  
</head>  

<body>  
  <div class="container">  
    <div class="wrap">  
      <section class="hero">  
        <div class="logo">  
          <div class="badge">H</div>  
          <div>  
            <div class="logo-title">Harmonia</div>  
            <div class="logo-subtitle">Votre espace de création et de partage.</div>  
          </div>  
        </div>  
        <h1>Bienvenue sur Harmonia.</h1>  
        <p>Explorez des communautés, forgez des alliances, vivez des expériences uniques. Ici, la connexion est réinventée.</p>  
      </section>  

      <aside class="card" aria-label="Portail d'authentification">  

        <!-- Signup -->  
        <div id="signup-section" class="form-section">  
          <h2 class="form-title">Créer un compte</h2>  
          <form id="signup-form" autocomplete="on" novalidate>  
            <div class="field"><label for="signup-firstname">Prénom</label><input id="signup-firstname" type="text" required /></div>  
            <div class="field"><label for="signup-lastname">Nom</label><input id="signup-lastname" type="text" required /></div>  
            <div class="field"><label for="signup-dob">Date de naissance</label><input id="signup-dob" type="date" required /></div>  
            <div class="field"><label for="signup-email">Adresse e-mail</label><input id="signup-email" type="email" required /></div>  
            <div class="field"><label for="signup-password">Mot de passe</label><input id="signup-password" type="password" minlength="6" required /></div>  
            <button class="btn" type="submit" id="signup-button">Rejoindre Harmonia</button>  
            <div id="signup-msg" class="msg"></div>  
          </form>  
        </div>  

        <hr class="card-divider">  

        <!-- Login -->  
        <div id="login-section" class="form-section">  
          <h2 class="form-title">Se connecter</h2>  
          <form id="login-form" autocomplete="on">  
            <div class="field"><label for="login-email">Adresse e-mail</label><input id="login-email" type="email" required /></div>  
            <div class="field"><label for="login-password">Mot de passe</label><input id="login-password" type="password" required /></div>  
            <button class="btn" type="submit" id="login-button">Entrer sur Harmonia</button>  
            <div id="login-msg" class="msg"></div>  
          </form>  
        </div>  

        <hr class="card-divider">  

        <!-- Reset -->  
        <div id="reset-section" class="form-section">  
          <h2 class="form-title">Mot de passe oublié</h2>  
          <form id="reset-form">  
            <div class="field"><label for="reset-email">E-mail</label><input id="reset-email" type="email" required /></div>  
            <button class="btn" type="submit" id="reset-button">Envoyer le lien</button>  
            <div id="reset-msg" class="msg"></div>  
          </form>  
        </div>  

      </aside>  
    </div>  
  </div>  

  <script>  
    document.addEventListener('DOMContentLoaded', () => {  
      const REDIRECT_URL = "home.html";  

      if (typeof GoTrue === 'undefined') {  
        console.error("GoTrue n'est pas chargé");  
        return;  
      }  

      const auth = new GoTrue({  
        APIUrl: "https://signupharmonia.netlify.app/.netlify/identity",  
        setCookie: true,  
      });  

      const showMsg = (el, text, type = 'is-error') => {  
        el.textContent = text;  
        el.className = `msg ${type} is-visible`;  
      };  

      // --- Signup ---  
      document.getElementById('signup-form').addEventListener('submit', async (e) => {  
        e.preventDefault();  
        const email = document.getElementById('signup-email').value.trim();  
        const password = document.getElementById('signup-password').value;  
        const firstname = document.getElementById('signup-firstname').value.trim();  
        const lastname = document.getElementById('signup-lastname').value.trim();  
        const dob = document.getElementById('signup-dob').value;  

        try {  
          const user = await auth.signup({  
            email,  
            password,  
            data: { first_name: firstname, last_name: lastname, date_of_birth: dob }  
          });  
          console.log("Inscription OK:", user);  
          showMsg(document.getElementById('signup-msg'), "Compte créé, vérifiez vos emails pour confirmer.", "is-success");  
        } catch (err) {  
          console.error("Erreur signup:", err);  
          showMsg(document.getElementById('signup-msg'), err.message || "Erreur à l'inscription");  
        }  
      });  

      // --- Login ---  
      document.getElementById('login-form').addEventListener('submit', async (e) => {  
        e.preventDefault();  
        const email = document.getElementById('login-email').value.trim();  
        const password = document.getElementById('login-password').value;  
        try {  
          const user = await auth.login(email, password, true);  
          console.log("Connexion OK:", user);  
          window.location.href = REDIRECT_URL;  
        } catch (err) {  
          console.error("Erreur login:", err);  
          showMsg(document.getElementById('login-msg'), err.message || "Email ou mot de passe incorrect");  
        }  
      });  

      // --- Reset ---  
      document.getElementById('reset-form').addEventListener('submit', async (e) => {  
        e.preventDefault();  
        const email = document.getElementById('reset-email').value.trim();  
        try {  
          await auth.requestPasswordRecovery(email);  
          showMsg(document.getElementById('reset-msg'), "Email envoyé (si le compte existe)", "is-success");  
        } catch (err) {  
          console.error("Erreur reset:", err);  
          showMsg(document.getElementById('reset-msg'), "Erreur lors de la récupération");  
        }  
      });  
    });  
  </script>  
</body>  
</html>
